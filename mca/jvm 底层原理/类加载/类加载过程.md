# JVM 类加载机制

## 1. 类加载过程

### 1. 加载

1. class ---> 文件流  ——>  类加载器（加载到方法区）
2. 在 堆内存中 创建指向 方法区内存的指针。
3. 注意：在类加载的过程中，可以对 类进行增强 （Java Agent）

### 2. 链接

#### 1. 验证 （取消验证： -Xverify:none）

1. 文件格式
2. 元数据验证：验证 java 语法格式
3. 字节码：
   1. 运行时检查
   2. 栈数据类型和操作码
4. 符号引用
   1. 符号引用转直接引用

#### 2. 准备

​	为类的静态变量分配内存，并赋予默认值。final 列外，在编译阶段赋初始值。

String，final static 修饰时，ConstantValue: 显示赋值。在常量池中获取。

#### 3. 解析

​	从 运行时常量池 的 符号引用 确定为 具体值（直接引用） 的过程。

1. 符号引用
2. 直接引用：真实的具体值。

### 3. 初始化

执行类构造方法（类变量的初始值1.构造器。2.静态代码块）

1. 类变量赋予初始值。

### 4. 使用

### 5. 卸载

1. 该类的所有实列都被回收
2. 该类的 类加载器被回收
3. 该类的所有 Class 没有被引用 

## 2.类加载器

### 1. 类加载器的分类

#### 1. BootStrap ClassLoader

#### 2. Extension ClassLoader

#### 3. Application ClassLoader

#### 4. Customer ClassLoader

### 2. 类加载器的特性

![](../../typroImage/jvm_classLoade_parent_asign.png)

#### 1. 全盘负责

当一个类负责加载某个类时，这个 class 依赖的，引用的 其他类，都由当前类加载器负责载入。

除非：显示使用另外一个类加载器。

#### 2. 双亲委派

#### 3. 缓存机制

会将加载过的类进行缓存。保证一个类只会被加载一次。

### 3.自定义类加载器

#### 1. 继承 ClassLoader

#### 2. 重写 findClass()