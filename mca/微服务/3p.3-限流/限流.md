## 1、流控

~~~
hystrix -- > 基于线程池的流控方式
~~~

### 1、流控算法

#### 1、令牌桶算法

redis ; 适应于突发流量场景 ；（流量队列 -- 拒绝策略）

~~~
1、令牌是可以累积的，处理 容量+生成速率 的流量 
~~~

#### 2、漏桶算法

~~~
有一个容器，将 请求保存起来，匀速控制到达后端的请求的速率

1、请求速率 太平稳，不能处理瞬间流量
~~~

#### 3、滑动时间窗口

sentinel

~~~
找到最小时间片，将一段时间分割为连续的时间片，动态计算整个连续时间片总的请求数，并对总请求数进行判断
~~~

## 2、熔断，限流，降级

~~~
1、都是为了系统稳定，防止因为个别服务不可用拖垮整个服务
2、都是为了让用户感知到服务不可用
3、服务级别的不可用
	可以做更细粒度的限制（只读）
~~~

|          | 熔断                     | 限流                       | 降级                                   |
| :------- | ------------------------ | -------------------------- | -------------------------------------- |
| 触发条件 | 某个下游服务不可用       | 达到限流规则，防止压垮服务 | 基于服务整体的负荷，主动降级           |
| 发生层次 | 每个服务都需要，不分层次 |                            | 首选外围服务进行降级，保证核心服务可用 |
|          |                          |                            |                                        |

### 1、断路器的隔离方式

线程池隔离 -- hystrix

~~~
对于关键核心的业务，通过采用单独分配线程池的方式，防止与其他业务共享线程导致的部分业务 饿死 的一种 分流方式
~~~



信号量隔离 -- sentinel -- 服务内部隔离

~~~
将信号量当作一个计数器，并规定一个上限，表示一个接口的最大访问量。
进入前后对信号量的值进行修改，达到计数器最大值后，不允许新的请求进入。
~~~

