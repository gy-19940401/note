# 微服务

## 1、nacos

### 1、注册中心

~~~
服务的注册
	1、服务注册
	2、服务发现
	3、服务拉取
	4、服务剔除
	5、服务调用（负载均衡 ribbon:轮询）
	6、服务同步
	
2、健康检查
	1、15s 检查一次，第一次检查到不健康
	2、超过 30s 就将对应服务下线，并从注册表剔除

3、服务同步
	1.0 ：http 心跳检测多，性能消耗大。
	gRPC : 远程调用框架；建立长连接；（发布订阅的形式）
	       客户端发送变化是，能够立马通知给服务端  ？？？？？
    
~~~



### 2、配置中心

~~~
1、命名空间 + DataID + 分组
2、支持动态配置
~~~



## 2、ribbon

## 3、feign

## 4、Sentinel

## 流控（sentinel）

~~~
1、统计资源（）
2、基于 SPI（Slot ProcessorSlot） 的 责任链模式 
~~~



### 1、固定时间窗口

### 2、滑动时间窗口算法

![image-20220905202504690](C:\Users\CSB7D0\Desktop\mca\typroImage\image-20220905202504690.png)

解决重复统计区域的问题

~~~
1、时间窗口划分的更细粒度（样本窗口）
   样本窗口足够小，小到忽略到样本窗口的中间状态
~~~

## 2、分布式事务(Seata)

~~~
1、AT    :两阶段提交
2、TCC   :
3、SAGA  :
4、XA    :

事务的统筹者（TC）：
事务的管理者（TM）：开启全局事务/开启回滚
事务的参与者（RM）：


(TM/RM) 注册到 TC
~~~



~~~
CAP 
1、CA
2、CP

BASE:(basically Availably  +  soft state   +  Eventually consistent)

1/
~~~



### 1、2PC 两阶段提交

~~~
1、准备阶段：
2、提交阶段：
3、回滚阶段：出现异常后需要回滚。
~~~

![image-20220905210853850](C:\Users\CSB7D0\Desktop\mca\typroImage\image-20220905210853850.png)