### 1、nacos(弱AP,CP)

![image-20221024201923962](C:\Users\CSB7D0\Desktop\mca\typroImage\image-20221024201923962.png)

~~~
1、服务注册 --> Map<serviceName,addr>
2、服务续约（健康检测） --> 心跳检测 ： 每隔 15s 检测一次；连续两次不健康 当前服务以下线
3、服务剔除 --> 剔除 被没有及时续约的服务
4、服务下线 --> 服务提供者主动下线，通知给注册中心
5、服务获取 --> 每个服务从注册中心获取健康状态的全部服务信息
6、服务调用（服务均衡（ribbon ; loadBalance）） --> 存在多个节点时决定调用那个服务；(轮询；hash...)；ribbon || feign ;; nacos 客户端 集成 ribbon


7、服务同步 --> gRPC（长连接）{
	1.X --> 心跳多，无效查询多，感知变化慢，连接消耗大，资源空耗严重
	2.X --> 发布订阅模型，对于下线的服务能够立马通知服务端 ？？？事件流程
}


CAP [一致性，可用性，分区容错性]
	CP --> 依赖于节点的选举（选主时就导致一段时间不可用）
	AP --> 节点平等（peer to peer）,数据是一样的，数据不强一致（最终一致性）
	
~~~

#### a、Raft 一致性协议（去中心化共识 参考 交易共识）

~~~

~~~



### 2、eureka（极高可用；强AP）

~~~
特性机制（服务获取/30s）
	自我保护 --> 15分钟内，低于 85% 个续约信息，就会启动自我保护，不允许剔除，只允许主动下线
	服务同步 --> 搭建服务集群时，会将注册信息在集群做转发
~~~

#### a、多级缓存

~~~
注册表内存（registry）
读写缓存（ReadWriteCacheMap）
只读缓存（ReadOnlyCacheMap）(30s 每次 主动同步 读写缓存，只读缓存过期)
~~~





### 3、consul（cp go语言）

### 4、zk（cp）

~~~
金融 || 大数据场景
~~~



## 